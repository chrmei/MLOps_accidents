schema: '2.0'
stages:
  preprocess:
    cmd: python src/data/make_dataset.py
    deps:
    - path: data/raw
      hash: md5
      md5: 90c3e04bb8fa1558eb70f9096b5b6010.dir
      size: 31082914
      nfiles: 4
    - path: src/data/make_dataset.py
      hash: md5
      md5: 27bbe8545fcf46545e7f4c947fafd6b6
      size: 8802
    outs:
    - path: data/preprocessed/interim_dataset.csv
      hash: md5
      md5: 0793a947d82089ff3b8617d904461295
      size: 7959718
  build_features:
    cmd: python src/features/build_features.py
    deps:
    - path: data/preprocessed/interim_dataset.csv
      hash: md5
      md5: 0793a947d82089ff3b8617d904461295
      size: 7959718
    - path: src/features/build_features.py
      hash: md5
      md5: 07b8548971be7f996f7ada1896fb0895
      size: 17853
    outs:
    - path: data/preprocessed/features.csv
      hash: md5
      md5: 34c692a7c2b09f4671b59c22c9e145c0
      size: 12677276
    - path: models/label_encoders.joblib
      hash: md5
      md5: 6c3813a0ffaa347be23b1924dbf394c2
      size: 18263
  train_eval:
    cmd: python src/models/train_model.py
    deps:
    - path: data/preprocessed/features.csv
      hash: md5
      md5: 34c692a7c2b09f4671b59c22c9e145c0
      size: 12677276
    - path: src/models/train_model.py
      hash: md5
      md5: 067551cb0132288c1d203193b47a860a
      size: 24151
    params:
      src/config/model_config.yaml:
        data_split:
          test_size: 0.3
          random_state: 42
          shuffle: true
        evaluation:
          metrics:
          - accuracy
          - precision
          - recall
          - f1
          save_confusion_matrix: true
          save_classification_report: true
        feature_engineering:
          apply_cyclic_encoding: true
          apply_interactions: true
        grid_search:
          enabled: false
          cv: 5
          scoring: f1
          n_jobs: -1
          verbose: 1
          param_grid:
            xgb__n_estimators:
            - 300
            - 500
            - 750
            - 1000
            xgb__max_depth:
            - 4
            - 5
            - 6
            xgb__learning_rate:
            - 0.01
            - 0.05
            - 0.1
            - 0.15
            - 0.2
            xgb__subsample:
            - 0.8
            - 1.0
            xgb__colsample_bytree:
            - 0.7
            - 0.8
            - 0.9
        mlflow:
          enabled: true
          tracking_uri: ''
          experiment_name: accident_prediction
          log_model: true
          log_artifacts: true
        model:
          type: xgboost
          name: XGBoost Baseline
        paths:
          features: data/preprocessed/features.csv
          model_output: models/trained_model.joblib
          metrics_dir: data/metrics
          label_encoders: models/label_encoders.joblib
          model_metadata: models/trained_model_metadata.joblib
        smote:
          enabled: true
          random_state: 42
        xgboost:
          default_params:
            colsample_bytree: 0.7
            learning_rate: 0.05
            max_depth: 4
            n_estimators: 1000
            subsample: 0.8
            random_state: 42
            eval_metric: logloss
    outs:
    - path: data/metrics/training_metrics.json
      hash: md5
      md5: 8668f4687aafcfd050a297208a075ac2
      size: 1378
    - path: data/metrics/training_report.txt
      hash: md5
      md5: 9646f1b51b40846ec42f6d5fc6d362a8
      size: 1520
    - path: models/trained_model.joblib
      hash: md5
      md5: f45b15a45d3a4cddee8ca84921e4e9c4
      size: 7235430
    - path: models/trained_model_metadata.joblib
      hash: md5
      md5: c740c14317ff5b5dd8c08524ba41c290
      size: 3495
  test_prediction:
    cmd: python src/models/predict_model.py
    deps:
    - path: models/label_encoders.joblib
      hash: md5
      md5: 6c3813a0ffaa347be23b1924dbf394c2
      size: 18263
    - path: models/trained_model.joblib
      hash: md5
      md5: f45b15a45d3a4cddee8ca84921e4e9c4
      size: 7235430
    - path: models/trained_model_metadata.joblib
      hash: md5
      md5: c740c14317ff5b5dd8c08524ba41c290
      size: 3495
    - path: src/models/predict_model.py
      hash: md5
      md5: 157d16a98c3801d3dbb945d4ecabebd3
      size: 6024
    params:
      src/models/test_features.json:
        actp: 0
        agg_: 2
        an: 2021
        an_nais: 1961
        atm: 0
        catr: 3
        catu: 3
        catv: 2
        circ: 2
        col: 6
        com: 77317
        dep: 77
        etatp: 0
        hrmn: 17:00
        infra: 0
        int: 1
        jour: 7
        larrout: 0.0
        lat: 48.6
        locp: 0
        long: 2.89
        lum: 5
        mois: 12
        motor: 1
        nb_vehicules: 1
        nb_victim: 2
        obs: 0
        obsm: 1
        place: 10
        plan: 0
        prof: 0
        secu1: 0.0
        sexe: 1
        situ: 1
        surf: 1
        v1: 0
        vma: 50
        vosp: 0
        year_acc: 2021
